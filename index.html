<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Baby Shower de Gabriela Eloísa — Lista de Regalos</title>
<meta name="theme-color" content="#f8c7de">
<style>
  :root {
    --rosa:#f8c7de;
    --rosa-osc:#e38db7;
    --fucsia:#d43f8d;
    --malva:#ffeef6;
    --gris:#6b7280;
    --verde:#10b981;
    --rojo:#ef4444;
  }
  * { box-sizing:border-box; }
  body {
    margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    color:#1f2937; background:linear-gradient(180deg, var(--malva), white 40%);
  }
  header {
    text-align:center; padding: 42px 16px 24px;
    background:
      radial-gradient(80px 80px at 10% 20%, rgba(255,255,255,.7), transparent 60%),
      radial-gradient(100px 100px at 90% 10%, rgba(255,255,255,.7), transparent 60%),
      linear-gradient(180deg, var(--rosa), #ffd7eb);
    color:#4b2142;
    position:relative;
  }
  header h1 { font-size: clamp(28px, 3vw, 40px); margin:0 0 6px; letter-spacing:.5px; }
  header p { margin:6px 0 0; font-size: 16px; color:#4b2142; }
  .card { width:min(900px, 92%); margin: -28px auto 40px; background:white;
          border-radius: 22px; box-shadow: 0 12px 30px rgba(212,63,141,.15);
          padding: 18px 18px 8px; border: 2px solid #ffd7eb; }
  .intro { background: #fff6fb; border:1px dashed var(--rosa-osc); padding:14px 16px; border-radius:16px; margin: 10px 0 18px; }
  .intro b { color:#84284e; }
  .row { display:grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap:12px; margin: 10px 0 18px; }
  .item { border:1px solid #f5c5dd; border-radius:16px; padding:12px 12px 10px; background:linear-gradient(180deg, #fff, #fff9fc); position:relative; }
  .item h3 { font-size:16px; margin:0 0 6px; color:#7a214e; }
  .tag { display:inline-block; font-size:12px; padding:2px 8px; border-radius:999px; background:#ffe3f2; color:#7a214e; border:1px solid #ffd1ea; }
  .desc { font-size:13px; color:var(--gris); margin:6px 0 10px; min-height: 34px; }
  .badge { position:absolute; top:10px; right:10px; font-size:11px; padding:3px 8px; border-radius:999px; border:1px solid #ffd1ea; background:#fff0f7; color:#7a214e; }
  .controls { display:flex; gap:8px; flex-wrap:wrap; }
  button, .ghost { border-radius:12px; padding:8px 10px; font-weight:600; border:2px solid var(--rosa-osc);
                    background: white; color:#7a214e; cursor:pointer; transition: transform .06s ease, box-shadow .15s ease, background .2s; }
  button:hover { transform: translateY(-1px); box-shadow:0 6px 16px rgba(212,63,141,.18); }
  .primary { background: var(--rosa-osc); color:white; border-color: var(--fucsia); }
  .primary:hover { background: var(--fucsia); }
  .ok { border-color: var(--verde); color:#065f46; }
  .ok:hover { background:#ecfdf5; }
  .muted { border-color:#e5e7eb; color:#374151; }
  .danger { border-color: var(--rojo); color:#7f1d1d; }
  .flex { display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between; }
  .hint { color:var(--gris); font-size:12px; }
  footer { text-align:center; color:var(--gris); padding: 8px 0 24px; font-size:12px; }
  .divider { height:1px; background:linear-gradient(90deg, transparent, #ffd7eb, transparent); margin:14px 0; }
  .pill { padding:8px 12px; background:#fff0f7; border:1px solid #ffd5ea; border-radius:999px; font-size:13px; color:#7a214e; }
  .verse { font-style:italic; font-size:14px; color:#6b214d; }
  .topbar { display:flex; gap:8px; flex-wrap:wrap; align-items:center; justify-content:center; margin-top: 8px; }
  .copy-area { display:none; }
  .banner {text-align:center; padding:10px 0; margin-bottom:6px;}
  .banner span {background:#fff0f7; border:1px solid #ffd5ea; border-radius:999px; padding:6px 10px; font-size:12px; color:#7a214e;}
  .place { display:flex; gap:6px; flex-wrap:wrap; justify-content:center; margin-top:8px; }
  /* Modal */
  .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.4);padding:16px;}
  .modal.open{display:flex;}
  .modal>div{background:#fff;border-radius:16px;padding:16px;max-width:420px;width:100%;box-shadow:0 20px 40px rgba(0,0,0,.2);border:2px solid #ffd7eb}
  .modal h4{margin:0 0 8px;color:#7a214e}
  .modal label{display:block;font-size:13px;color:#374151;margin:8px 0 4px}
  .modal input,.modal textarea{width:100%;padding:10px;border:1px solid #e5e7eb;border-radius:10px}
  .modal .rowbtn{display:flex;gap:8px;justify-content:flex-end;margin-top:12px}
</style>
</head>
<body>
<header>
  <h1>Baby Shower de Gabriela Eloísa</h1>
  <p class="verse">“¿Y quién sabe si para esta hora has llegado al reino?” — Ester 4:14</p>
  <div class="topbar">
    <span class="pill">Fecha: 08 de octubre de 2025</span>
    <span class="pill">Hora: 1:30 p.m.</span>
    <span class="pill">Tema: Esther</span>
    <span class="pill">Sin código de vestimenta</span>
  </div>
  <div class="place">
    <span class="pill">Lugar: Av. Amazonas N47-279 y Río Palora. Sector Labrador</span>
  </div>
</header>

<main class="card">
  <div class="intro">
    <p><b>¡Gracias por celebrar con nosotros!</b> Escoge un regalo de la lista. Al pulsar <b>Reservar</b>, podrás escribir tu nombre; la reserva quedará <b>visible para todos</b> y se enviará una <b>confirmación por WhatsApp</b> a los anfitriones.</p>
  </div>

  <div class="flex">
    <div class="hint">Tip: si un artículo ya está reservado, verás quién lo tomó.</div>
    <div>
      <a class="primary" id="whatsappRSVP" target="_blank" rel="noopener">Confirmar asistencia (WhatsApp)</a>
      <a class="ghost" id="mapLink" target="_blank" rel="noopener">Ver mapa</a>
    </div>
  </div>

  <div class="divider"></div>

  <section id="grid" class="row">

    <!-- Ítems (según versión final del usuario). Aseguramos que data-id == data-key en botones. -->
    <article class="item" data-key="it7">
      <span class="badge" data-badge="it7"></span>
      <h3>Biberones</h3>
      <span class="tag">Lactancia</span>
      <p class="desc">Anticólicos.</p>
      <div class="controls">
        <button class="primary" data-act="reserve" data-id="it7">Reservar</button>
        <button class="muted" data-act="copy" data-id="it7">Copiar</button>
      </div>
    </article>

    <article class="item" data-key="it8">
      <span class="badge" data-badge="it8"></span>
      <h3>Toallitas húmedas (x6)</h3>
      <span class="tag">Higiene</span>
      <p class="desc">Sin fragancia, para piel sensible.</p>
      <div class="controls">
        <button class="primary" data-act="reserve" data-id="it8">Reservar</button>
        <button class="muted" data-act="copy" data-id="it8">Copiar</button>
      </div>
    </article>

    <article class="item" data-key="it9">
      <span class="badge" data-badge="it9"></span>
      <h3>Crema anti-rozaduras</h3>
      <span class="tag">Higiene</span>
      <p class="desc">Con óxido de zinc.</p>
      <div class="controls">
        <button class="primary" data-act="reserve" data-id="it9">Reservar</button>
        <button class="muted" data-act="copy" data-id="it9">Copiar</button>
      </div>
    </article>

    <article class="item" data-key="it10">
      <span class="badge" data-badge="it10"></span>
      <h3>Shampoo & jabón neutro bebé</h3>
      <span class="tag">Baño</span>
      <p class="desc">pH suave, hipoalergénico.</p>
      <div class="controls">
        <button class="primary" data-act="reserve" data-id="it10">Reservar</button>
        <button class="muted" data-act="copy" data-id="it10">Copiar</button>
      </div>
    </article>

    <article class="item" data-key="it11">
      <span class="badge" data-badge="it11"></span>
      <h3>Bañera para bebé con soporte</h3>
      <span class="tag">Baño</span>
      <p class="desc">Con soporte antideslizante.</p>
      <div class="controls">
        <button class="primary" data-act="reserve" data-id="it11">Reservar</button>
        <button class="muted" data-act="copy" data-id="it11">Copiar</button>
      </div>
    </article>

    <article class="item" data-key="it12">
      <span class="badge" data-badge="it12"></span>
      <h3>Toallas con capucha (x2)</h3>
      <span class="tag">Baño</span>
      <p class="desc">Algodón suave.</p>
      <div class="controls">
        <button class="primary" data-act="reserve" data-id="it12">Reservar</button>
        <button class="muted" data-act="copy" data-id="it12">Copiar</button>
      </div>
    </article>

    <article class="item" data-key="it13">
      <span class="badge" data-badge="it13"></span>
      <h3>Manta/Swaddle muselina (x3)</h3>
      <span class="tag">Ropa & Ropa de cama</span>
      <p class="desc">Ligera para envolver.</p>
      <div class="controls">
        <button class="primary" data-act="reserve" data-id="it13">Reservar</button>
        <button class="muted" data-act="copy" data-id="it13">Copiar</button>
      </div>
    </article>

    <article class="item" data-key="it14">
      <span class="badge" data-badge="it14"></span>
      <h3>Mantitas afelpadas (x2)</h3>
      <span class="tag">Ropa & Ropa de cama</span>
      <p class="desc">Para abrigo.</p>
      <div class="controls">
        <button class="primary" data-act="reserve" data-id="it14">Reservar</button>
        <button class="muted" data-act="copy" data-id="it14">Copiar</button>
      </div>
    </article>

    <article class="item" data-key="it15">
      <span class="badge" data-badge="it15"></span>
      <h3>Babitas / Paños de eructo (x6)</h3>
      <span class="tag">Ropa & Ropa de cama</span>
      <p class="desc">Absorbentes.</p>
      <div class="controls">
        <button class="primary" data-act="reserve" data-id="it15">Reservar</button>
        <button class="muted" data-act="copy" data-id="it15">Copiar</button>
      </div>
    </article>

    <article class="item" data-key="it16">
      <span class="badge" data-badge="it16"></span>
      <h3>Bodys manga corta 0–3m (x5)</h3>
      <span class="tag">Ropa</span>
      <p class="desc">Algodón 100%.</p>
      <div class="controls">
        <button class="primary" data-act="reserve" data-id="it16">Reservar</button>
        <button class="muted" data-act="copy" data-id="it16">Copiar</button>
      </div>
    </article>

    <article class="item" data-key="it17">
      <span class="badge" data-badge="it17"></span>
      <h3>Bodys manga larga 3–6m (x5)</h3>
      <span class="tag">Ropa</span>
      <p class="desc">Para clima fresco.</p>
      <div class="controls">
        <button class="primary" data-act="reserve" data-id="it17">Reservar</button>
        <button class="muted" data-act="copy" data-id="it17">Copiar</button>
      </div>
    </article>

    <article class="item" data-key="it18">
      <span class="badge" data-badge="it18"></span>
      <h3>Pijamas enterizas 0–3m (x4)</h3>
      <span class="tag">Ropa</span>
      <p class="desc">Con broches.</p>
      <div class="controls">
        <button class="primary" data-act="reserve" data-id="it18">Reservar</button>
        <button class="muted" data-act="copy" data-id="it18">Copiar</button>
      </div>
    </article>

    <article class="item" data-key="it19">
      <span class="badge" data-badge="it19"></span>
      <h3>Medias y mitones (x6)</h3>
      <span class="tag">Ropa</span>
      <p class="desc">Protegen del frío y rasguños.</p>
      <div class="controls">
        <button class="primary" data-act="reserve" data-id="it19">Reservar</button>
        <button class="muted" data-act="copy" data-id="it19">Copiar</button>
      </div>
    </article>

    <article class="item" data-key="it20">
      <span class="badge" data-badge="it20"></span>
      <h3>Gorritos algodón (x3)</h3>
      <span class="tag">Ropa</span>
      <p class="desc">Recién nacida.</p>
      <div class="controls">
        <button class="primary" data-act="reserve" data-id="it20">Reservar</button>
        <button class="muted" data-act="copy" data-id="it20">Copiar</button>
      </div>
    </article>

    <article class="item" data-key="it21">
      <span class="badge" data-badge="it21"></span>
      <h3>Baberos (x6)</h3>
      <span class="tag">Alimentación</span>
      <p class="desc">Para leche y babeo.</p>
      <div class="controls">
        <button class="primary" data-act="reserve" data-id="it21">Reservar</button>
        <button class="muted" data-act="copy" data-id="it21">Copiar</button>
      </div>
    </article>

    <article class="item" data-key="it25">
      <span class="badge" data-badge="it25"></span>
      <h3>Chupón + clip (x2)</h3>
      <span class="tag">Confort</span>
      <p class="desc">Silicona grado médico.</p>
      <div class="controls">
        <button class="primary" data-act="reserve" data-id="it25">Reservar</button>
        <button class="muted" data-act="copy" data-id="it25">Copiar</button>
      </div>
    </article>

    <article class="item" data-key="it26">
      <span class="badge" data-badge="it26"></span>
      <h3>Cojín de lactancia</h3>
      <span class="tag">Lactancia</span>
      <p class="desc">Ergonómico.</p>
      <div class="controls">
        <button class="primary" data-act="reserve" data-id="it26">Reservar</button>
        <button class="muted" data-act="copy" data-id="it26">Copiar</button>
      </div>
    </article>

    <article class="item" data-key="it27">
      <span class="badge" data-badge="it27"></span>
      <h3>Discos protectores lactancia</h3>
      <span class="tag">Lactancia</span>
      <p class="desc">Reutilizables o desechables.</p>
      <div class="controls">
        <button class="primary" data-act="reserve" data-id="it27">Reservar</button>
        <button class="muted" data-act="copy" data-id="it27">Copiar</button>
      </div>
    </article>

    <article class="item" data-key="it28">
      <span class="badge" data-badge="it28"></span>
      <h3>Bolsas para leche materna</h3>
      <span class="tag">Lactancia</span>
      <p class="desc">Para congelar/guardar.</p>
      <div class="controls">
        <button class="primary" data-act="reserve" data-id="it28">Reservar</button>
        <button class="muted" data-act="copy" data-id="it28">Copiar</button>
      </div>
    </article>

    <article class="item" data-key="it29">
      <span class="badge" data-badge="it29"></span>
      <h3>Portabebés tipo canguro</h3>
      <span class="tag">Paseo & Cambio</span>
      <p class="desc">Para salidas.</p>
      <div class="controls">
        <button class="primary" data-act="reserve" data-id="it29">Reservar</button>
        <button class="muted" data-act="copy" data-id="it29">Copiar</button>
      </div>
    </article>

    <article class="item" data-key="it30">
      <span class="badge" data-badge="it30"></span>
      <h3>Detergente para bebé</h3>
      <span class="tag">Limpieza</span>
      <p class="desc">Hipoalergénico.</p>
      <div class="controls">
        <button class="primary" data-act="reserve" data-id="it30">Reservar</button>
        <button class="muted" data-act="copy" data-id="it30">Copiar</button>
      </div>
    </article>

    <article class="item" data-key="it31">
      <span class="badge" data-badge="it31"></span>
      <h3>Cambiador color blanco</h3>
      <span class="tag">Paseo & Cambio</span>
      <p class="desc">Para salidas.</p>
      <div class="controls">
        <button class="primary" data-act="reserve" data-id="it31">Reservar</button>
        <button class="muted" data-act="copy" data-id="it31">Copiar</button>
      </div>
    </article>

    <article class="item" data-key="it32">
      <span class="badge" data-badge="it32"></span>
      <h3>Colchita y sábanas para cuna (juego)</h3>
      <span class="tag">Ropa de cama</span>
      <p class="desc">Extras siempre útiles.</p>
      <div class="controls">
        <button class="primary" data-act="reserve" data-id="it32">Reservar</button>
        <button class="muted" data-act="copy" data-id="it32">Copiar</button>
      </div>
    </article>

    <!-- ÚLTIMOS: todos los pañales al final -->
    <article class="item" data-key="it0">
      <span class="badge" data-badge="it0"></span>
      <h3>Pañales RN/0 (pack)</h3>
      <span class="tag">Higiene</span>
      <p class="desc">Hipoalergénicos.</p>
      <div class="controls">
        <button class="primary" data-act="reserve" data-id="it0">Reservar</button>
        <button class="muted" data-act="copy" data-id="it0">Copiar</button>
      </div>
    </article>

    <article class="item" data-key="it1">
      <span class="badge" data-badge="it1"></span>
      <h3>Pañales RN/0 (pack) — Extra 1</h3>
      <span class="tag">Higiene</span>
      <p class="desc">Prioridad alta (recién nacidos).</p>
      <div class="controls">
        <button class="primary" data-act="reserve" data-id="it1">Reservar</button>
        <button class="muted" data-act="copy" data-id="it1">Copiar</button>
      </div>
    </article>

    <article class="item" data-key="it2">
      <span class="badge" data-badge="it2"></span>
      <h3>Pañales RN/0 (pack) — Extra 2</h3>
      <span class="tag">Higiene</span>
      <p class="desc">Prioridad alta (recién nacidos).</p>
      <div class="controls">
        <button class="primary" data-act="reserve" data-id="it2">Reservar</button>
        <button class="muted" data-act="copy" data-id="it2">Copiar</button>
      </div>
    </article>

    <article class="item" data-key="it3">
      <span class="badge" data-badge="it3"></span>
      <h3>Pañales Talla 1 (pack)</h3>
      <span class="tag">Higiene</span>
      <p class="desc">Para usar al mes 1–2.</p>
      <div class="controls">
        <button class="primary" data-act="reserve" data-id="it3">Reservar</button>
        <button class="muted" data-act="copy" data-id="it3">Copiar</button>
      </div>
    </article>

    <article class="item" data-key="it4">
      <span class="badge" data-badge="it4"></span>
      <h3>Pañales Talla 1 (pack) — Extra</h3>
      <span class="tag">Higiene</span>
      <p class="desc">Stock adicional.</p>
      <div class="controls">
        <button class="primary" data-act="reserve" data-id="it4">Reservar</button>
        <button class="muted" data-act="copy" data-id="it4">Copiar</button>
      </div>
    </article>

    <article class="item" data-key="it5">
      <span class="badge" data-badge="it5"></span>
      <h3>Pañales Talla 2 (pack)</h3>
      <span class="tag">Higiene</span>
      <p class="desc">Para meses 3–4.</p>
      <div class="controls">
        <button class="primary" data-act="reserve" data-id="it5">Reservar</button>
        <button class="muted" data-act="copy" data-id="it5">Copiar</button>
      </div>
    </article>

    <article class="item" data-key="it6">
      <span class="badge" data-badge="it6"></span>
      <h3>Pañales Talla 3 (pack)</h3>
      <span class="tag">Higiene</span>
      <p class="desc">Para meses 5–6.</p>
      <div class="controls">
        <button class="primary" data-act="reserve" data-id="it6">Reservar</button>
        <button class="muted" data-act="copy" data-id="it6">Copiar</button>
      </div>
    </article>

    <article class="item" data-key="it7p4">
      <span class="badge" data-badge="it7p4"></span>
      <h3>Pañales Talla 4 (pack)</h3>
      <span class="tag">Higiene</span>
      <p class="desc">Para meses 7–9.</p>
      <div class="controls">
        <button class="primary" data-act="reserve" data-id="it7p4">Reservar</button>
        <button class="muted" data-act="copy" data-id="it7p4">Copiar</button>
      </div>
    </article>

  </section>

  <div class="divider"></div>
  <div class="banner"><span>Hecho con amor para <b>Gabriela Eloísa</b>. Última actualización: 04/10/2025 — Reservas en tiempo real</span></div>
  <footer>
    <span class="hint">Las reservas se guardan en la nube y se muestran en tiempo real. Si WhatsApp no se abre automáticamente, tu navegador pedirá confirmación para enviar.</span>
  </footer>
</main>

<!-- Firebase SDK (compat para simplicidad). Sustituye firebaseConfig con tus claves del proyecto. -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>
<script>
// 1) CONFIGURA TU PROYECTO FIREBASE AQUÍ
// Crea un proyecto en https://console.firebase.google.com, habilita Realtime Database en modo test o con reglas seguras,
// y pega tu config a continuación.
const firebaseConfig = {
  apiKey: "TU_API_KEY",
  authDomain: "TU_PROJECT_ID.firebaseapp.com",
  databaseURL: "https://TU_PROJECT_ID-default-rtdb.firebaseio.com",
  projectId: "TU_PROJECT_ID",
  storageBucket: "TU_PROJECT_ID.appspot.com",
  messagingSenderId: "",
  appId: ""
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const ADMIN_PHONE = "+593983379301"; // WhatsApp del anfitrión

// 2) Utilidades DOM
function qs(sel, ctx=document){ return ctx.querySelector(sel); }
function qsa(sel, ctx=document){ return Array.from(ctx.querySelectorAll(sel)); }

// 3) Construir catálogo de items desde el DOM
const items = {};
qsa('.item').forEach(card => {
  const key = card.getAttribute('data-key');
  const title = qs('h3', card).textContent.trim();
  const note = qs('.desc', card)?.textContent.trim() || '';
  items[key] = { key, title, note };
});

// 4) Render de estado de reservas en tiempo real
const reservationsRef = db.ref('babyshower_gabriela/reservations');
reservationsRef.on('value', snap => {
  const data = snap.val() || {};
  for (const key in items){
    const r = data[key];
    const card = qs(`[data-key="${key}"]`);
    const btn = qs(`button[data-id="${key}"][data-act="reserve"]`, card);
    const badge = qs(`[data-badge="${key}"]`);
    if (!card || !btn) continue;
    if (r && r.reserved){
      btn.disabled = true;
      btn.textContent = 'Ya reservado';
      badge.textContent = `Reservado por ${r.name || '—'}`;
    } else {
      btn.disabled = false;
      btn.textContent = 'Reservar';
      badge.textContent = '';
    }
  }
});

// 5) Modal para pedir nombre y (opcional) mensaje
const modal = document.createElement('div');
modal.className = 'modal';
modal.innerHTML = `
  <div>
    <h4>Confirma tu reserva</h4>
    <p style="font-size:13px;color:#6b7280">Escribe tu nombre para que todos vean quién reservó este regalo.</p>
    <label>Tu nombre</label>
    <input type="text" id="resv_name" placeholder="Ej. Ana Pérez" />
    <label>Mensaje opcional</label>
    <textarea id="resv_msg" rows="3" placeholder="Ej. Lo llevaré el día del evento"></textarea>
    <div class="rowbtn">
      <button class="muted" id="resv_cancel">Cancelar</button>
      <button class="primary" id="resv_ok">Confirmar</button>
    </div>
  </div>`;

document.body.appendChild(modal);
let pendingKey = null;

function openModal(key){ pendingKey = key; modal.classList.add('open'); qs('#resv_name').focus(); }
function closeModal(){ modal.classList.remove('open'); pendingKey = null; }
qs('#resv_cancel', modal).addEventListener('click', closeModal);

// 6) Acciones de botones
addEventListener('click', (e) => {
  const btn = e.target.closest('button');
  if(!btn) return;
  const act = btn.dataset.act;
  const id = btn.dataset.id;
  if(!act || !id) return;

  if(act === 'copy'){
    const { title, note } = items[id];
    navigator.clipboard.writeText(`${title} — ${note}`);
    btn.textContent = 'Copiado';
    setTimeout(()=>btn.textContent='Copiar',1200);
  }
  if(act === 'reserve'){
    openModal(id);
  }
});

qs('#resv_ok', modal).addEventListener('click', async ()=>{
  const name = qs('#resv_name').value.trim();
  const msg = qs('#resv_msg').value.trim();
  if(!name){ alert('Por favor escribe tu nombre.'); return; }
  const key = pendingKey; if(!key){ return; }
  const item = items[key];
  const ref = reservationsRef.child(key);
  try{
    // Comprobamos si ya está reservado
    const snap = await ref.get();
    if(snap.exists() && snap.val().reserved){
      alert('Este artículo ya fue reservado por otra persona.');
      closeModal();
      return;
    }
    // Guardamos la reserva
    const payload = {
      reserved: true,
      name,
      note: msg || '',
      ts: Date.now()
    };
    await ref.set(payload);
    // Log histórico opcional
    await db.ref('babyshower_gabriela/logs').push({ key, ...payload });
    closeModal();

    // Abrimos WhatsApp al anfitrión con el mensaje de confirmación listo para enviar
    const text = `Hola, confirmo mi reserva para el Baby Shower de Gabriela Eloísa:%0A• Artículo: ${encodeURIComponent(item.title)}%0A• Nota: ${encodeURIComponent(item.note)}%0A• Mi nombre: ${encodeURIComponent(name)}${msg?`%0A• Mensaje: ${encodeURIComponent(msg)}`:''}`;
    const wa = `https://wa.me/${ADMIN_PHONE.replace('+','')}?text=${text}`;
    window.open(wa, '_blank');
  } catch(err){
    console.error(err);
    alert('No se pudo guardar la reserva. Revisa tu conexión e inténtalo de nuevo.');
  }
});

// 7) RSVP y mapa
(function setupExtras(){
  const rsvp = document.getElementById('whatsappRSVP');
  if (rsvp) {
    const msg = encodeURIComponent(`Hola 👋 Confirmo mi asistencia al baby shower de Gabriela Eloísa el 08 de octubre de 2025 a la 1:30 p.m. en Av. Amazonas N47-279 y Río Palora. Sector Labrador. (Sin código de vestimenta)`);
    rsvp.href = 'https://wa.me/593983379301?text=' + msg;
  }
  const map = document.getElementById('mapLink');
  if (map) {
    const q = encodeURIComponent('Av. Amazonas N47-279 y Río Palora. Sector Labrador');
    map.href = 'https://www.google.com/maps/search/?api=1&query=' + q;
  }
})();
</script>
</body>
</html>
