<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Baby Shower de Gabriela Eloísa — Lista de Regalos</title>
<meta name="theme-color" content="#f8c7de">
<style>
  :root { --rosa:#f8c7de; --rosa-osc:#e38db7; --fucsia:#d43f8d; --malva:#ffeef6; --gris:#6b7280; --rojo:#ef4444; }
  * { box-sizing:border-box; }
  body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Helvetica,Arial;color:#1f2937;background:linear-gradient(180deg,var(--malva),#fff 40%)}
  header{ text-align:center; padding:42px 16px 24px; color:#4b2142;
    background:
      radial-gradient(80px 80px at 10% 20%, rgba(255,255,255,.7), transparent 60%),
      radial-gradient(100px 100px at 90% 10%, rgba(255,255,255,.7), transparent 60%),
      linear-gradient(180deg, var(--rosa), #ffd7eb);
  }
  header h1{ font-size:clamp(28px,3vw,40px); margin:0 0 6px; letter-spacing:.5px; }
  .verse{ font-style:italic; font-size:14px; color:#6b214d; }
  .topbar{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; justify-content:center; margin-top:8px; }
  .pill{ padding:8px 12px; background:#fff0f7; border:1px solid #ffd5ea; border-radius:999px; font-size:13px; color:#7a214e; }
  .place{ display:flex; gap:6px; flex-wrap:wrap; justify-content:center; margin-top:8px; }
  .card{ width:min(900px,92%); margin:-28px auto 40px; background:#fff; border-radius:22px; box-shadow:0 12px 30px rgba(212,63,141,.15); padding:18px 18px 8px; border:2px solid #ffd7eb }
  .intro{ background:#fff6fb; border:1px dashed var(--rosa-osc); padding:14px 16px; border-radius:16px; margin:10px 0 18px; }
  .divider{ height:1px; background:linear-gradient(90deg,transparent,#ffd7eb,transparent); margin:14px 0; }
  .row{ display:grid; grid-template-columns:repeat(auto-fit,minmax(240px,1fr)); gap:12px; margin:10px 0 18px; }
  .item{ position:relative; border:1px solid #f5c5dd; border-radius:16px; padding:12px 12px 10px; background:linear-gradient(180deg,#fff,#fff9fc) }
  .item h3{ font-size:16px; margin:0 0 6px; color:#7a214e }
  .tag{ display:inline-block; font-size:12px; padding:2px 8px; border-radius:999px; background:#ffe3f2; color:#7a214e; border:1px solid #ffd1ea }
  .badge{ position:absolute; top:10px; right:10px; font-size:12px; padding:2px 8px; border-radius:999px; background:#fef3c7; border:1px solid #fde68a; color:#92400e }
  .desc{ font-size:13px; color:var(--gris); margin:6px 0 10px; min-height:34px }
  .controls{ display:flex; gap:8px; flex-wrap:wrap }
  button{ border-radius:12px; padding:8px 10px; font-weight:600; border:2px solid var(--rosa-osc); background:#fff; color:#7a214e; cursor:pointer }
  .primary{ background:var(--rosa-osc); color:#fff; border-color:var(--fucsia) }
  .muted{ border-color:#e5e7eb; color:#374151 }
  .danger{ border-color:var(--rojo); color:#991b1b }
  footer{ text-align:center; color:var(--gris); padding:8px 0 24px; font-size:12px; }
  .banner{ text-align:center; padding:10px 0; margin-bottom:6px; }
  .banner span{ background:#fff0f7; border:1px solid #ffd5ea; border-radius:999px; padding:6px 10px; font-size:12px; color:#7a214e; }
</style>
</head>
<body>
<header>
  <h1>Baby Shower de Gabriela Eloísa</h1>
  <p class="verse">“¿Y quién sabe si para esta hora has llegado al reino?” — Ester 4:14</p>
  <div class="topbar">
    <span class="pill">Fecha: 08 de noviembre de 2025</span>
    <span class="pill">Hora: 1:30 p.m.</span>
    <span class="pill">Sin código de vestimenta</span>
  </div>
  <div class="place">
    <span class="pill">Lugar: Av. Amazonas N47-279 y Río Palora. Sector Labrador</span>
  </div>
</header>

<main class="card">
  <div class="intro">
    <p><b>¡Gracias por celebrar con nosotros!</b> Elige un regalo y pulsa <b>Reservar</b>. La reserva queda <b>visible para todos</b> y se abre <b>WhatsApp</b> para avisar al anfitrión. </b>.</p>
  </div>

  <div class="divider"></div>
  <section id="grid" class="row"></section>
  <div class="divider"></div>

  <div class="banner"><span>Hecho con amor para <b>Gabriela Eloísa</b>. Última actualización: 04/10/2025</span></div>
  <footer><span class="hint">Las reservas se guardan en tiempo real. Si un artículo ya está tomado, verás “Reservado por …”.</span></footer>
</main>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getDatabase, ref, onValue, runTransaction, get, set } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

/* === CONFIG (verifica databaseURL EXACTO de tu RTDB) === */
const firebaseConfig = {
  apiKey: "AIzaSyDqmNK2nF6KJsVcZFdP4VPHUKLiL89HIjg",
  authDomain: "babyshowergaby-4ce16.firebaseapp.com",
  databaseURL: "https://babyshowergaby-4ce16-default-rtdb.firebaseio.com", // <- aquí
  projectId: "babyshowergaby-4ce16",
  storageBucket: "babyshowergaby-4ce16.firebasestorage.app",
  messagingSenderId: "367031549351",
  appId: "1:367031549351:web:4b07dec773d4334dd20a82"
};
const app = initializeApp(firebaseConfig);
const db  = getDatabase(app);

/* === DATOS EVENTO === */
const ADMIN_PHONE = "+593983379301";

/* === LISTA (pañales al final) === */
const ITEMS = [
  { key:"it1",  title:"Biberones marca avant", tag:"Lactancia", note:"Anticólicos." },
  { key:"it2",  title:"Crema anti-rozaduras", tag:"Higiene", note:"Con óxido de zinc." },
  { key:"it3",  title:"Shampoo & jabón neutro bebé", tag:"Baño", note:"pH suave, hipoalergénico." },
  { key:"it4",  title:"Bañera para bebé con soporte", tag:"Baño", note:"Con soporte antideslizante." },
  { key:"it5",  title:"Manta/Swaddle muselina (x3)", tag:"Ropa & Ropa de cama", note:"Ligera para envolver." },
  { key:"it6",  title:"Mantitas afelpadas (x2)", tag:"Ropa & Ropa de cama", note:"Para abrigo." },
  { key:"it7",  title:"Babitas / Paños de eructo (x3)", tag:"Ropa & Ropa de cama", note:"Absorbentes." },
  { key:"it8", title:"Bodys manga corta 0–3m (x3)", tag:"Ropa", note:"Algodón 100%." },
  { key:"it9", title:"Bodys manga larga 3–6m (x3)", tag:"Ropa", note:"Para clima fresco." },
  { key:"it10", title:"Pijamas enterizas 0–3m (x3)", tag:"Ropa", note:"Con broches." },
  { key:"it11", title:"Medias y mitones (x6)", tag:"Ropa", note:"Protegen del frío y rasguños." },
  { key:"it12", title:"Gorritos algodón (x3)", tag:"Ropa", note:"Recién nacida." },
  { key:"it13", title:"Baberos (x6)", tag:"Alimentación", note:"Para leche y babeo." },
  { key:"it14", title:"Chupón + clip (x2)", tag:"Confort", note:"Silicona grado médico." },
  { key:"it15", title:"Cojín de lactancia", tag:"Lactancia", note:"Ergonómico." },
  { key:"it16", title:"Discos protectores lactancia", tag:"Lactancia", note:"Reutilizables o desechables." },
  { key:"it17", title:"Bolsas para leche materna", tag:"Lactancia", note:"Para congelar/guardar." },
  { key:"it18", title:"Portabebés tipo canguro", tag:"Paseo & Cambio", note:"Para salidas." },
  { key:"it19", title:"Detergente para bebé", tag:"Limpieza", note:"Hipoalergénico." },
  { key:"it20", title:"Cambiador color blanco", tag:"Paseo & Cambio", note:"Para salidas." },
  { key:"it21", title:"Nido color lila claro", tag:"confort." },
  { key:"it22", title:"Lima de uñas para bebé", tag:"Higiene", note:"kit." },
  { key:"it23", title:"Pañalera grande lila claro o rosa", tag:"Paseo & Cambio." },
  { key:"it24", title:"Caja musical", tag:"Confort." },
  { key:"it25", title:"Mecedora eléctrica", tag:"Confort." },
  { key:"it26", title:"Pañales RN/0 (pack)", tag:"Higiene", note:"Hipoalergénicos (recomendacion de marca: panolini)." },
  { key:"it27", title:"Pañales RN/0 (pack) — Extra 1", tag:"Higiene", note:"Prioridad alta (recién nacidos)(recomendacion de marca: panolini)." },
  { key:"it28", title:"Pañales RN/0 (pack) — Extra 2", tag:"Higiene", note:"Prioridad alta (recién nacidos)(recomendacion de marca: panolini)." },
  { key:"it29", title:"Pañales Talla 1 (pack)", tag:"Higiene", note:"Para usar al mes 1–2 (recomendacion de marca: panolini)." },
  { key:"it30", title:"Pañales Talla 1 (pack) — Extra", tag:"Higiene", note:"(recomendacion de marca: panolini)." },
  { key:"it31", title:"Pañales Talla 2 (pack)", tag:"Higiene", note:"Para meses 3–4 (recomendacion de marca: panolini)." },
  { key:"it32", title:"Pañales Talla 3 (pack)", tag:"Higiene", note:"Para meses 5–6 (recomendacion de marca: panolini)." },
  { key:"it33", title:"Pañales Talla 4 (pack)", tag:"Higiene", note:"Para meses 7–9 (recomendacion de marca: panolini)." }
];

/* === Render === */
const grid = document.getElementById('grid');
grid.innerHTML = ITEMS.map(it => `
  <article class="item" data-key="${it.key}">
    <h3>${it.title}</h3>
    <span class="tag">${it.tag}</span>
    <span class="badge" data-badge="${it.key}"></span>
    <p class="desc">${it.note}</p>
    <div class="controls">
      <button class="primary" data-act="reserve" data-id="${it.key}">Reservar</button>
      <button class="muted" data-act="copy" data-id="${it.key}">Copiar</button>
    </div>
  </article>
`).join('');

/* === Estado en vivo === */
ITEMS.forEach(it => {
  const r = ref(db, `babyshower_gabriela/reservations/${it.key}`);
  onValue(r, (snap) => {
    const data = snap.val();
    const card  = document.querySelector(`[data-key="${it.key}"]`);
    const btn   = card?.querySelector(`button[data-act="reserve"][data-id="${it.key}"]`);
    const badge = card?.querySelector(`[data-badge="${it.key}"]`);
    let btnCancel = card?.querySelector(`button[data-act="cancel"][data-id="${it.key}"]`);

    if (data && data.reserved){
      if (btn){ btn.disabled = true; btn.textContent = "Ya reservado"; }
      if (badge){ badge.textContent = `Reservado por ${data.name || "—"}`; }
      if (!btnCancel){
        btnCancel = document.createElement("button");
        btnCancel.className = "danger";
        btnCancel.dataset.act = "cancel";
        btnCancel.dataset.id  = it.key;
        btnCancel.textContent = "Cancelar (PIN)";
        card.querySelector(".controls").appendChild(btnCancel);
      }
    } else {
      if (btn){ btn.disabled = false; btn.textContent = "Reservar"; }
      if (badge){ badge.textContent = ""; }
      if (btnCancel){ btnCancel.remove(); }
    }
  });
});

/* === Utilidad WhatsApp (evita bloqueos de pop-ups) === */
function openWhatsAppToHost(itTitle, itNote, name, extraMsg=""){
  const phone = ADMIN_PHONE.replace(/\+/g, "");
  const text =
    "Hola, confirmo mi reserva para el Baby Shower de Gabriela Eloísa:%0A" +
    "• Artículo: " + encodeURIComponent(itTitle) + "%0A" +
    "• Nota: " + encodeURIComponent(itNote) + "%0A" +
    "• Mi nombre: " + encodeURIComponent(name) +
    (extraMsg ? "%0A• Mensaje: " + encodeURIComponent(extraMsg) : "");
  const wa = `https://wa.me/${phone}?text=${text}`;
  // Navegamos en la misma pestaña para evitar bloqueos:
  window.location.assign(wa);
}

/* === Acciones === */
addEventListener('click', async (e) => {
  const b = e.target.closest('button'); if(!b) return;
  const act = b.dataset.act, id = b.dataset.id; if(!act || !id) return;
  const r = ref(db, `babyshower_gabriela/reservations/${id}`);

  if (act === 'copy'){
    const it = ITEMS.find(x=>x.key===id);
    try {
      await navigator.clipboard.writeText(`${it.title} — ${it.note}`);
      b.textContent = 'Copiado'; setTimeout(()=>b.textContent='Copiar',1200);
    } catch {}
    return;
  }

  if (act === 'reserve'){
    const name = prompt('Escribe tu nombre para reservar:'); if(!name) return;
    try {
      const res = await runTransaction(r, (cur) => {
        if (cur && cur.reserved) return cur; // ya tomado, no sobreescribe
        return { reserved:true, name, ts: Date.now() };
      });
      if (!res.committed){ alert('Este artículo ya fue reservado por otra persona.'); return; }

      const it = ITEMS.find(x=>x.key===id);
      // Ir directo a WhatsApp (sin pop-up)
      openWhatsAppToHost(it.title, it.note, name);
    } catch(err){
      console.error(err);
      alert('No se pudo guardar la reserva. Revisa reglas/URL de la base.');
    }
  }

  if (act === 'cancel'){
    const pin = prompt('PIN de anfitrión para cancelar:'); if(!pin) return;
    try {
      const snap = await get(r); const cur = snap.val();
      if (!cur || !cur.reserved){ alert('Este artículo no está reservado.'); return; }
      await set(r, { reserved:false, name: cur.name, ts: cur.ts, pin, cancelTs: Date.now() });
      alert('Reserva cancelada ✓');
    } catch(err){
      console.error(err);
      alert('No se pudo cancelar. Verifica el PIN o las reglas.');
    }
  }
});
</script>
</body>
</html>
